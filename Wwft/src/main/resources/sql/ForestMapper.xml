<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
		PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ForestMapper">
 	
 	
	<resultMap id="forestSelectMap" type="forest">
	<result property="forestNo" 					column="FOREST_NO" 		jdbcType="NUMERIC"/>
	<result property="forestName"					column="FOREST_NAME" 	jdbcType="VARCHAR" />
	<result property="forestCreaterTreeNo" 			column="FOREST_CTREATER_TREE_NO" 				jdbcType="NUMERIC" />
	<result property="invitePossibleState" 			column="INVITE_POSSIBLE_STATE" 		jdbcType="CHAR" />
	<result property="forestNameChangePossibleState" 		column="FOREST_NAME_CHANGE_POSSIBLE_STATE" 			jdbcType="CHAR" />
	<result property="forestCreateRegDate" 			column="FOREST_CREATE_TIME" 	jdbcType="DATE" />
	<result property="forestInformText" 			column="FOREST_INFORM_TEXT" 			jdbcType="VARCHAR" />
	<result property="forestInformWriter" 			column="FOREST_INFORM_WRITER" 			jdbcType="VARCHAR" />
	<result property="forestInformRegDate" 			column="FOREST_INFORM_REG_DATE" 	jdbcType="DATE" />
	</resultMap>
	
	
	<resultMap id="treeSelectMap" type="tree">
		<result property="treeNo" 			column="tree_no" 		jdbcType="NUMERIC"/>
		<result property="userId"			column="user_id" 		jdbcType="VARCHAR" />
		<result property="treeName" 		column="tree_name" 		jdbcType="VARCHAR" />
		<result property="seedNo" 			column="seed_no" 		jdbcType="VARCHAR" />
		<result property="treeImageName" 	column="tree_image_name" 	jdbcType="VARCHAR" />
		<result property="countryId" 		column="country_id" 		jdbcType="VARCHAR" />
		<result property="familyMotto" 		column="family_motto" 		jdbcType="VARCHAR" />
		<result property="activityTotalPoint" 	column="activity_total_point" 	jdbcType="NUMERIC" />
	</resultMap>
	
	
	 
	<!--  SQL : SELECT ONE -->
	 <select 	id="getForest"	parameterType="int"	resultMap="forestSelectMap">
		SELECT
		 	FOREST_NO,FOREST_NAME,FOREST_CTREATER_TREE_NO,INVITE_POSSIBLE_STATE,FOREST_NAME_CHANGE_POSSIBLE_STATE,FOREST_CREATE_TIME,
		 	FOREST_INFORM_TEXT,FOREST_INFORM_WRITER,FOREST_INFORM_REG_DATE
		FROM FOREST 
		WHERE FOREST_NO = #{value}
	 </select>
 	
 	<!-- SQL : INSERT -->
	<insert 	id="addForest"		parameterType="forest" >
	 	INSERT
		INTO FOREST(FOREST_NO,FOREST_NAME,FOREST_CTREATER_TREE_NO,INVITE_POSSIBLE_STATE,
					FOREST_NAME_CHANGE_POSSIBLE_STATE,FOREST_CREATE_TIME,FOREST_INFORM_TEXT,FOREST_INFORM_WRITER,FOREST_INFORM_REG_DATE ) 
		VALUES	 (	SEQ_FOREST_NO.nextval,#{forestName},#{forestCreaterTreeNo},
				#{invitePossibleState},#{forestNameChangePossibleState},SYSDATE,
				#{forestInformText},#{forestInformWriter},NULL )
	 </insert>
	 
	 <!-- SQL : UPDATE -->
	 <update	id="updateForestName"	parameterType="forest" >
	   	UPDATE FOREST
	   	<set>
	   		FOREST_NAME = #{forestName}
	   	</set>
	   	WHERE FOREST_NO = #{forestNo}
	 </update>
 	
 	<!--  SQL : SELECT ONE -->
	 <select 	id="checkForestName"	parameterType="forest"	resultType="int">
		SELECT
		 	count(*)
		FROM FOREST 
		WHERE FOREST_NAME = #{forestName}
	 </select>
	 
	<!-- SQL : SELECT LIST -->
	<select id="getTreeList" parameterType="int" resultMap="treeSelectMap">
		select tree.*
			from tree,(select * from tree_forest where forest_no = #{value}) treef
			where tree.tree_no = treef.tree_no
	
	</select>
	 
	<!-- SQL : SELECT REST LIST -->
	<select id="getTreeRestList" parameterType="java.util.HashMap" resultMap="treeSelectMap">
		select rt.*
    		from (select rownum rnum,tree.*
                from tree,(select * from tree_forest where forest_no = #{forestNo}) treef
                where tree.tree_no = treef.tree_no
                order by tree.tree_no) rt                
			where rnum BETWEEN #{pageNumber}*4-3 and #{pageNumber}*4
	
	</select> 
 	
 	<!-- SQL : UPDATE -->
	 <update	id="updateForestInform"	parameterType="forest" >
	   	UPDATE FOREST
	   	<set>
	   		FOREST_INFORM_TEXT = #{forestInformText},
	   		FOREST_INFORM_WRITER = #{forestInformWriter},
	   		FOREST_INFORM_REG_DATE = SYSDATE
	   	</set>
	   	WHERE FOREST_NO = #{forestNo}
	 </update>
 	
	 
</mapper>